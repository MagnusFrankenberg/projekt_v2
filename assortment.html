<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>

    <div id="outer_container" class="container">

     <!--navbar -->
      <nav id="navbar_assort" class="navbar navbar-expand-md sticky-lg-top">
        <div class="container">
          <a href="#" class="navbar-brand">MyStore</a>
          <button class="navbar-toggler" data-bs-toggle="collapse"
          data-bs-target="#nav">
          <div class="navbar-toggler-icon"></div>
        </button>
          <div class="collapse navbar-collapse" id="nav">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Products</a>
                  <div id="dropdown-menu" class="dropdown-menu">
                   
                  </div>                            
                </li>
              <li class="nav-item">
                <a href="./orderForm.html" class="nav-link active">Checkout</a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">Contact</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
   

    </div>



        <script>
    function loadContent(){
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "products.json");
        xhr.send();
        xhr.onreadystatechange = function(){
            if(xhr.readyState === 4 && xhr.status === 200){
                const json = JSON.parse(xhr.response);  //parse response to JSON format
               
                renderCards(json)
              }
            }
    }

    //Vi skapar en funktion som renderar det vi vill från json-objektet
    function renderCards(json){

      //Array med unika categorier:
      const uniqueCategories = [...new Set(json.map(e=>e.category))];
      

      //Skapar upp category-divs 
      uniqueCategories.forEach(e=>{
        let category = document.createElement("div");
        category.setAttribute('id',`id_${e}`)
        category.setAttribute('class','category')
        category.innerHTML = `<h2 class="category_header">${e}</h2>`;
        document.getElementById('outer_container').append(category);

        //categories -  skapa upp row-col div och lägg i category:
        let rowCol = document.createElement("div");
        rowCol.setAttribute('id',`rc_${e}`);
        rowCol.setAttribute('class','row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 gy-3 gx-3 p-3');
        category.append(rowCol);

        
        //categories -  lägg categories i dropdown-menu
        let dropdownItem = document.createElement("a");
        dropdownItem.className = 'dropdown-item';
        dropdownItem.setAttribute('href',`#id_${e}`);
        dropdownItem.innerHTML = `${e}`;
        document.getElementById('dropdown-menu').append(dropdownItem);

      })

      json.forEach(e=>{
        //skapa upp col som card ligger i
        let cardCol = document.createElement("div");
        cardCol.setAttribute('class',`col d-flex align-items-stretch`);

        //lägg cardcol i korrekt row-col category:
        document.getElementById(`rc_${e.category}`).append(cardCol);

        //skapa card och lägg i cardcol
        let card = document.createElement("div");
        card.setAttribute('class',`card`);
        cardCol.append(card);

        //skapa image och lägg i card
        let img = document.createElement("img");
        img.className = "card-img-top";
        img.src = `${e.image}`;
        card.append(img);

        //skapa card-body
        let cardBody = document.createElement("div");
        cardBody.className = "card-body";
        card.append(cardBody);

        //skapa card-title och lägg till card-body
        let cardTitle = document.createElement("h2");
        cardTitle.className = "card-title";
        cardTitle.innerHTML = `${e.title}`;
        cardBody.append(cardTitle);





        //skapa card-text och lägg till card body
        let cardText = document.createElement("div");
        cardText.className = "card-text collapse";
        cardText.innerHTML = `${e.description}`;
        cardBody.append(cardText);

        //skapa card-footer och lägg till card
        let cardFooter = document.createElement("div");
        cardFooter.className = "card-footer p-2";
        card.append(cardFooter);

        //skapa d-flex och lägg till cardFooter
        let dFlex = document.createElement("div");
        dFlex.className = "d-flex justify-content-between align-items-center";
        cardFooter.append(dFlex);

        //skapa pricetag och lägg till d-flex
        let price = document.createElement("h4");
        price.className = "price pt-2";
        price.innerHTML =  `€${e.price}`;
        dFlex.append(price);

        //skapa button och lägg till d-flex
        let btn = document.createElement("a");
        btn.className = "btn btn-outline-success p-2";
        btn.setAttribute('id',`addCart_${e.id}`);
        btn.href = "#";
        btn.innerHTML = "Add to cart";
        btn.addEventListener('click', (event)=>{
          addToCart(e);
        });
        dFlex.append(btn);


        //skapa rating och lägg till cardfooter
        let rating = document.createElement("p");
        rating.className = "rating";
        rating.innerHTML = `Rating: ${e.rating.rate} (${e.rating.count})`;
        cardFooter.append(rating);

///Modal///

        //Skapa modal  https://getbootstrap.com/docs/4.0/components/modal/
        let modal = document.createElement("div");
        modal.className = "modal fade modal-sm";
        modal.setAttribute('id',`modal_${e.id}`);
        modal.setAttribute('tabindex','-1');
        modal.setAttribute('role','dialog');
        modal.setAttribute('aria-labelledby','exampleModalCenterTitle');
        modal.setAttribute('aria-hidden', 'true');
        document.getElementById('outer_container').append(modal);

        //skapa modal-dialog
        let modalDialog = document.createElement("div");
        modalDialog.className = "modal-dialog modal-dialog-centered";
        modalDialog.setAttribute('role','document');
        modal.append(modalDialog);

        //skapa modal content
        let modalContent = document.createElement("div");
        modalContent.className = 'modal-content';
        modalDialog.append(modalContent);

        //skapa modalHeader
        let modalHeader = document.createElement("div");
        modalHeader.className = 'modal-header';
        modalContent.append(modalHeader);

        //skapa modal-title
        let modalTitle = document.createElement("h5");
        modalTitle.className = 'modal-title';
        modalTitle.setAttribute('id', 'exampleModalLongTitle');
        modalTitle.innerHTML = `${e.title}`;
        modalHeader.append(modalTitle);

        //skapa modalbody
        let modalBody = document.createElement("div");
        modalBody.className = 'modal-body';
        modalBody.innerHTML = `${e.description}`;
        modalContent.append(modalBody);
       

        //skapa modal-footer
        let modalFooter = document.createElement("div");
        modalFooter.className = 'modal-footer';
        modalContent.append(modalFooter);

        //lägg till close-knapp
        let modalCloseBtn = document.createElement("button");
        modalCloseBtn.setAttribute('type','button');
        modalCloseBtn.setAttribute('class','btn btn-secondary');
        modalCloseBtn.setAttribute('data-bs-dismiss','modal');
        modalCloseBtn.setAttribute('data-bs-target', `#modal_${e.id}`);
        modalCloseBtn.innerHTML = 'Close';
        modalFooter.append(modalCloseBtn);


        /////////
        //skapa link för modal
        let linkModal = document.createElement("a");
        linkModal.className = "linkModal stretched-link";  //blockerar Add to cart knappen, löst med z-index
        linkModal.setAttribute('href', `modal_${e.id}`);
        linkModal.setAttribute('data-bs-toggle', 'modal');
        linkModal.setAttribute('data-bs-target', `#modal_${e.id}`);
        linkModal.innerHTML = "Read more...";
        cardBody.append(linkModal);
       // console.log(linkModal);
        

      
      })
    
    }

    function addToCart(e){

      //Get current cart from localstorage or create a new one if not exists:
     let shoppingCart = JSON.parse(localStorage.getItem("shoppingCart")) || [];
    
      let newItem = {
        title: e.title,
        price: e.price,
      };

      shoppingCart.push(newItem);

      localStorage.setItem("shoppingCart", JSON.stringify(shoppingCart));

      console.log(shoppingCart);

      

    }

    


    loadContent();




        </script>
</body>
</html>